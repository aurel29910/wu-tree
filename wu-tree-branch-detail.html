<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wu Tree - Business & Finance</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #FFB6C1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .phone-frame {
            width: 375px;
            height: 812px;
            background: linear-gradient(135deg, #B4E1D4 0%, #D4B4E1 50%, #F5C5D4 100%);
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            overflow: hidden;
            position: relative;
        }

        .status-bar {
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: rgba(255,255,255,0.95);
            font-size: 14px;
            font-weight: 500;
            background: rgba(0,0,0,0.1);
        }

        .header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
        }

        .back-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-title {
            flex: 1;
        }

        .branch-name {
            color: white;
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .branch-subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 13px;
            margin-top: 2px;
        }

        .canvas-container {
            position: relative;
            height: calc(100% - 44px - 66px - 70px);
            overflow: hidden;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .center-node {
            cursor: pointer;
        }

        .goal-node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .goal-node:hover circle {
            r: 32;
        }

        .why-node {
            cursor: pointer;
            opacity: 0.85;
        }

        .branch-line {
            stroke: rgba(255,255,255,0.4);
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
        }

        .node-circle {
            fill: rgba(255,255,255,0.25);
            stroke: rgba(255,255,255,0.5);
            stroke-width: 2;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
        }

        .center-circle {
            fill: linear-gradient(135deg, #FFD700, #FFA500);
            animation: pulse-center 3s ease-in-out infinite;
        }

        @keyframes pulse-center {
            0%, 100% { r: 35; }
            50% { r: 40; }
        }

        .node-text {
            fill: white;
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .center-text {
            font-size: 28px;
        }

        .why-text {
            font-size: 10px;
            font-style: italic;
            opacity: 0.9;
        }

        .add-button {
            position: fixed;
            bottom: 30px;
            right: calc(50% - 167px);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            border: none;
            color: white;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255,105,180,0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .add-button:active {
            transform: scale(0.9);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 375px;
            height: 812px;
            background: rgba(0,0,0,0.6);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #B4E1D4 0%, #D4B4E1 50%, #F5C5D4 100%);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-title {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: rgba(255,255,255,0.9);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 15px;
        }

        .form-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(255,255,255,0.6);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .info-text {
            color: rgba(255,255,255,0.8);
            font-size: 13px;
            text-align: center;
            margin-top: 15px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="status-bar">
            <span>9:41</span>
            <span>üì∂ üîã</span>
        </div>

        <div class="header">
            <button class="back-button" onclick="goBack()">‚Üê</button>
            <div class="header-title">
                <div class="branch-name">üí∞ Business & Finance</div>
                <div class="branch-subtitle" id="subtitle">Vue arborescente</div>
            </div>
        </div>

        <div class="canvas-container">
            <svg id="treeSvg" viewBox="0 0 375 650">
                <!-- Les branches seront g√©n√©r√©es ici -->
            </svg>
        </div>

        <button class="add-button" onclick="openAddModal()">+</button>

        <!-- Modal pour ajouter un objectif -->
        <div class="modal" id="addModal">
            <div class="modal-content">
                <h2 class="modal-title">Nouvel objectif</h2>
                
                <div class="form-group">
                    <label class="form-label">Quel est ton objectif ?</label>
                    <input type="text" class="form-input" id="goalInput" placeholder="Ex: Atteindre 10k‚Ç¨/mois">
                </div>

                <div class="form-group">
                    <label class="form-label">Pourquoi est-ce important ?</label>
                    <input type="text" class="form-input" id="whyInput" placeholder="Ex: Libert√© financi√®re">
                </div>

                <p class="info-text">üí° Le "pourquoi" est ta motivation profonde</p>

                <button class="btn btn-primary" onclick="saveGoal()">Cr√©er</button>
                <button class="btn btn-secondary" onclick="closeAddModal()">Annuler</button>
            </div>
        </div>
    </div>

    <script>
        let goals = [];
        const svg = document.getElementById('treeSvg');
        const centerX = 187.5;
        const centerY = 580;

        // Charger les objectifs depuis localStorage
        function loadGoals() {
            const saved = localStorage.getItem('wutree_business_goals');
            goals = saved ? JSON.parse(saved) : [];
            renderTree();
        }

        // Sauvegarder les objectifs
        function saveGoals() {
            localStorage.setItem('wutree_business_goals', JSON.stringify(goals));
        }

        // Rendre l'arbre
        function renderTree() {
            svg.innerHTML = '';

            // N≈ìud central (TOI)
            const centerGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            centerGroup.classList.add('center-node');
            
            const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerCircle.setAttribute('cx', centerX);
            centerCircle.setAttribute('cy', centerY);
            centerCircle.setAttribute('r', 35);
            centerCircle.classList.add('node-circle', 'center-circle');
            centerCircle.style.fill = 'url(#centerGradient)';

            // Gradient pour le centre
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            gradient.setAttribute('id', 'centerGradient');
            gradient.setAttribute('x1', '0%');
            gradient.setAttribute('y1', '0%');
            gradient.setAttribute('x2', '100%');
            gradient.setAttribute('y2', '100%');
            
            const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop1.setAttribute('offset', '0%');
            stop1.setAttribute('style', 'stop-color:#FFD700;stop-opacity:1');
            
            const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop2.setAttribute('offset', '100%');
            stop2.setAttribute('style', 'stop-color:#FFA500;stop-opacity:1');
            
            gradient.appendChild(stop1);
            gradient.appendChild(stop2);
            defs.appendChild(gradient);
            svg.appendChild(defs);

            const centerText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText.setAttribute('x', centerX);
            centerText.setAttribute('y', centerY + 10);
            centerText.classList.add('node-text', 'center-text');
            centerText.textContent = 'üßò';

            centerGroup.appendChild(centerCircle);
            centerGroup.appendChild(centerText);
            svg.appendChild(centerGroup);

            // Mettre √† jour le sous-titre
            document.getElementById('subtitle').textContent = `${goals.length} objectif${goals.length > 1 ? 's' : ''}`;

            // Dessiner les objectifs
            const angleStep = Math.PI / (goals.length + 1);
            goals.forEach((goal, index) => {
                const angle = Math.PI - angleStep * (index + 1);
                const distance = 180;
                const goalX = centerX + Math.cos(angle) * distance;
                const goalY = centerY - Math.sin(angle) * distance;

                // Ligne vers l'objectif
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                line.setAttribute('d', `M ${centerX} ${centerY} Q ${centerX} ${centerY - 50} ${goalX} ${goalY}`);
                line.classList.add('branch-line');
                svg.appendChild(line);

                // N≈ìud objectif
                const goalGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                goalGroup.classList.add('goal-node');
                goalGroup.onclick = () => editGoal(index);

                const goalCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                goalCircle.setAttribute('cx', goalX);
                goalCircle.setAttribute('cy', goalY);
                goalCircle.setAttribute('r', 28);
                goalCircle.classList.add('node-circle');
                goalCircle.style.fill = 'rgba(255,182,193,0.3)';

                const goalText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                goalText.setAttribute('x', goalX);
                goalText.setAttribute('y', goalY - 35);
                goalText.classList.add('node-text');
                goalText.textContent = truncate(goal.title, 15);

                const goalEmoji = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                goalEmoji.setAttribute('x', goalX);
                goalEmoji.setAttribute('y', goalY + 8);
                goalEmoji.classList.add('node-text');
                goalEmoji.style.fontSize = '20px';
                goalEmoji.textContent = 'üéØ';

                goalGroup.appendChild(goalCircle);
                goalGroup.appendChild(goalText);
                goalGroup.appendChild(goalEmoji);
                svg.appendChild(goalGroup);

                // Si "pourquoi" existe, cr√©er un sous-n≈ìud
                if (goal.why) {
                    const whyDistance = 80;
                    const whyX = goalX + Math.cos(angle) * whyDistance;
                    const whyY = goalY - Math.sin(angle) * whyDistance;

                    // Ligne vers le pourquoi
                    const whyLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    whyLine.setAttribute('x1', goalX);
                    whyLine.setAttribute('y1', goalY);
                    whyLine.setAttribute('x2', whyX);
                    whyLine.setAttribute('y2', whyY);
                    whyLine.classList.add('branch-line');
                    whyLine.style.strokeWidth = '1.5';
                    whyLine.style.strokeDasharray = '3,3';
                    svg.appendChild(whyLine);

                    // N≈ìud pourquoi
                    const whyGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    whyGroup.classList.add('why-node');

                    const whyCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    whyCircle.setAttribute('cx', whyX);
                    whyCircle.setAttribute('cy', whyY);
                    whyCircle.setAttribute('r', 20);
                    whyCircle.classList.add('node-circle');
                    whyCircle.style.fill = 'rgba(144,238,144,0.3)';

                    const whyText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    whyText.setAttribute('x', whyX);
                    whyText.setAttribute('y', whyY - 25);
                    whyText.classList.add('node-text', 'why-text');
                    whyText.textContent = truncate(goal.why, 12);

                    const whyEmoji = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    whyEmoji.setAttribute('x', whyX);
                    whyEmoji.setAttribute('y', whyY + 6);
                    whyEmoji.classList.add('node-text');
                    whyEmoji.style.fontSize = '16px';
                    whyEmoji.textContent = 'üíö';

                    whyGroup.appendChild(whyCircle);
                    whyGroup.appendChild(whyText);
                    whyGroup.appendChild(whyEmoji);
                    svg.appendChild(whyGroup);
                }
            });
        }

        function truncate(text, maxLength) {
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
            document.getElementById('goalInput').value = '';
            document.getElementById('whyInput').value = '';
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
        }

        function saveGoal() {
            const title = document.getElementById('goalInput').value.trim();
            const why = document.getElementById('whyInput').value.trim();

            if (!title) {
                alert('Merci de renseigner un objectif');
                return;
            }

            goals.push({
                id: Date.now(),
                title: title,
                why: why || null,
                createdAt: new Date().toISOString()
            });

            saveGoals();
            renderTree();
            closeAddModal();
        }

        function editGoal(index) {
            if (confirm(`Supprimer "${goals[index].title}" ?`)) {
                goals.splice(index, 1);
                saveGoals();
                renderTree();
            }
        }

        function goBack() {
            window.location.href = 'wu-tree-branch-detail.html';
        }

        // Charger au d√©marrage
        loadGoals();
    </script>
</body>
</html>
